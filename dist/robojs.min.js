"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.robojs=e.robojs||{})}(void 0,function(e){function t(){function e(e,t,n){if(0===o.length)return!0;for(var r=void 0,i=0;i<o.length;i++){var u=o[i];if(u.listener===e&&u.scope===n){r=u;break}}if(!r)return!0;if(r.once!==t)throw new Error("You cannot addOnce() then add() the same listener without removing the relationship first.");return!1}function t(t,n,r){if(o||(o=[]),e(t,n,r)){var i={listener:t,scope:r,once:n};o=o.concat([i])}return o}function n(e){for(var t=o?o.length:0,n=0;n<t;n++){var i=o[n],u=i.listener,a=i.scope;i.once&&r(u,a),u.call(a,e)}}function r(e,t){for(var n=[],r=0;r<o.length;r++){var i=o[r];i.listener===e&&i.scope===t?(i.listener=null,i.scope=null,o[r]=null):n.push(i)}return o=n}function i(){return o=null}var o=[],u=function(e,n){return t(e,!1,n)},a=function(e,n){return t(e,!0,n)};return Object.freeze({connect:u,connectOnce:a,disconnect:r,disconnectAll:i,emit:n})}function n(e,t,r){return function(){for(var i=[],o=0,u=e,a=0;a<t.length||o<arguments.length;){var s;a<t.length?s=t[a]:(s=arguments[o],o+=1),i[a]=s,u-=1,a+=1}return u<=0?r.apply(this,i):d(u,n(e,i,r))}}function r(e,t){return function(){return t.call(this,e.apply(this,arguments))}}function i(e){return"[object String]"===Object.prototype.toString.call(e)}function o(e){for(var t,n,r,i=[],u=0,a=e.length;u<a;){if(x(e[u]))for(t=o(e[u]),r=0,n=t.length;r<n;)i[i.length]=t[r],r+=1;else i[i.length]=e[u];u+=1}return i}function u(e,t){return b(function(e){return e.length>0?t(e):[]},_(function(e){return e.length>0}),y(E),_(function(e){return e.querySelectorAll}),o,g(e))}var a=function(e,t,n){require([e],t,n)},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;return Object.freeze({load:function(t){return new Promise(function(n,r){return e(t,n,r)})}})},l=function(){function e(){_classCallCheck(this,e),this._listeners={}}return _createClass(e,[{key:"addEventListener",value:function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t}},{key:"removeEventListener",value:function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var o=0,u=i.length;o<u;o++)if(i[o]==t){1==u?delete r[e]:i.splice(o,1);break}}}},{key:"removeAllEventListeners",value:function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null}},{key:"dispatchEvent",value:function(e){if("string"==typeof e){var t=this._listeners;if(!t||!t[e])return!1;e=new Event(e)}else e.target&&e.clone&&(e=e.clone());try{e.target=this}catch(e){}if(e.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var i,o=r.length;for(i=o-1;i>=0&&!e.propagationStopped;i--)r[i]._dispatchEvent(e,1+(0==i));for(i=1;i<o&&!e.propagationStopped;i++)r[i]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented}},{key:"hasEventListener",value:function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])}},{key:"_dispatchEvent",value:function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;try{e.currentTarget=this}catch(e){}try{e.eventPhase=t}catch(e){}e.removed=!1,i=i.slice();for(var o=0;o<n&&!e.immediatePropagationStopped;o++){var u=i[o];u.handleEvent?u.handleEvent(e):u(e),e.removed&&(this.removeEventListener(e.type,u,1==t),e.removed=!1)}}}}]),e}(),c=new l,f=function(){return new l},h=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,e),this.data=n,this.type=t,this.bubbles=r,this.cancelable=i,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1,this.target,this.currentTarget,this.eventPhase=0}return _createClass(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"remove",value:function(){this.removed=!0}},{key:"clone",value:function(){return new e(this.type,this.data,this.bubbles,this.cancelable)}}]),e}(),d=function(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,i){return t.apply(this,arguments)};case 5:return function(e,n,r,i,o){return t.apply(this,arguments)};case 6:return function(e,n,r,i,o,u){return t.apply(this,arguments)};case 7:return function(e,n,r,i,o,u,a){return t.apply(this,arguments)};case 8:return function(e,n,r,i,o,u,a,s){return t.apply(this,arguments)};case 9:return function(e,n,r,i,o,u,a,s,l){return t.apply(this,arguments)};case 10:return function(e,n,r,i,o,u,a,s,l,c){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}},p=function(e){return function t(n){return 0===arguments.length?t:e.apply(this,arguments)}},v=function(e){var t=e.length;return 1===t?p(e):d(t,n(t,[],e))},y=v(function(e,t){var n=0,r=t.length,i=[];for(n;n<r;n++)i[n]=e(t[n]);return i}),g=v(function(e,t){return y(function(t){return t[e]},t)}),m=v(function(e,t,n){for(var r=0,i=n.length;r<i;)t=e(t,n[r]),r+=1;return t}),b=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.reverse();var i=t[0],o=t.slice(1);return d(i.length,m(r,i,o))},x=function(e){return!!Array.isArray(e)||!!e&&("object"===(void 0===e?"undefined":_typeof(e))&&(!i(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))},_=v(function(e,t){for(var n=0,r=t.length,i=[];n<r;)e(t[n])&&(i[i.length]=t[n]),n+=1;return i}),E=function(e){var t=[].slice.call(e.querySelectorAll("[data-mediator]"),0);return e.getAttribute("data-mediator")&&t.unshift(e),t},S=function(e){function n(){l.disconnect(),r.disconnectAll(),i.disconnectAll(),l=null,r=null,i=null,o=null,a=null}var r=t(),i=t(),o=u("addedNodes",r.emit),a=u("removedNodes",i.emit),s=function(e){a(e),o(e)},l=new MutationObserver(s);return l.observe(e,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),Object.freeze({onAdded:r,onRemoved:i,dispose:n})},k="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",w=function(){return k.replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},L=function(e){return e},A=v(function(e,t,n){var r=w();return e.setAttribute("mediatorid",r),{mediatorId:r,node:e,dispose:n(e,t)||L}}),P=v(function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return t[n];n+=1}}),j=function(e,t){return!!P(function(e){return e.node===t},e)},O=function(e,t,n){return v(function(r,i,o){return i(e(o)).then(t(o,r)).then(n)})},C=v(function(e,t){return e[t.getAttribute("data-mediator")]}),M=function(e){function t(e){for(var t=0;t<l.length;t++){var n=l[t];n&&n.node===e&&(n.dispose(),n.node=null,l[t]=null,l.splice(t,1))}return l}function n(){l.forEach(function(e){e&&(e.dispose(),e.node=null)}),l=null,s.removeAllEventListeners(),s=null,h=null,u=null,c=null}function r(e){return l.push(e),l}function i(e){return!!c(e)&&!j(l,e)}var o=e.definitions,u=void 0===o?{}:o,a=e.dispatcher,s=void 0===a?f():a,l=[],c=C(u),h=O(c,A,r);return Object.freeze({dispose:n,destroy:t,findMediator:h(s),hasMediator:i,getAllElements:E})},D=function(e,t){return b(function(e){return Promise.all(e)},y(e),_(t),o)},T=v(function(e,t){for(var n=t.length,r=0;r<n;)e(t[r]),r+=1;return t}),z=function(e){return b(T(e),o)},q=function(e){return b(e,y(E),function(e){return[e]})},R=function(e){var t=e.definitions,n=e.loader,r=void 0===n?s():n,i=e.root,o=void 0===i?document.body:i,u=e.mediatorHandler||M({definitions:t}),a=e.domWatcher||S(o),l=D(u.findMediator(r.load),u.hasMediator);a.onAdded.connect(l),a.onRemoved.connect(z(u.destroy));var c=q(l)(o);return{promise:c,dispose:function(){a.dispose(),u.dispose(),a=null,u=null,l=null,t=null,r=null,o=null,c=null}}};e.bootstrap=R,e.MediatorHandler=M,e.DomWatcher=S,e.Signal=t,e.RJSEvent=h,e.makeDispatcher=f,e.EventDispatcher=c,e.Loader=s,Object.defineProperty(e,"__esModule",{value:!0})});