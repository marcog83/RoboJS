/*! RoboJS 0.0.1 (RoboJS Build) | MIT */
!function(a,b){"function"==typeof define&&define.amd?define(["lodash","signals","Promise"],b):a.RoboJS=b(a._,a.signals,a.Promise)}(this,function(a,b,c){"use strict";function d(){this.onAdded=new b.Signal,this.onRemoved=new b.Signal;var a=new MutationObserver(this.handleMutations.bind(this));a.observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}function e(){this._currentListeners={}}function f(a,b,c,d,e){this.dispatcher=a,this.eventString=b,this.listener=c,this.callback=d,this.scope=e}function g(){this._listeners=[]}function h(a){this.element=a,this.eventMap=new g,this.eventDispatcher=e.getInstance()}function i(){}function j(a){this.onAdded=new b.Signal,this.onRemoved=new b.Signal,this.definitions=a||[],this.displayList=new d,this.displayList.onAdded.add(this._handleNodesAdded,this),this.displayList.onRemoved.add(this._handleNodesRemoved,this),this.loader=new i}var RoboJS={MEDIATORS_CACHE:{},utils:{uid:["0","0","0"],nextUid:function(){for(var a,b=this.uid.length;b;){if(b--,a=this.uid[b].charCodeAt(0),57==a)return this.uid[b]="A",this.uid.join("");if(90!=a)return this.uid[b]=String.fromCharCode(a+1),this.uid.join("");this.uid[b]="0"}return this.uid.unshift("0"),this.uid.join("")}}};return d.prototype={handleMutations:function(b){var c=a.reduce(b,function(a,b){return a.addedNodes=a.addedNodes.concat(Array.prototype.slice.call(b.addedNodes)),a.removedNodes=a.removedNodes.concat(Array.prototype.slice.call(b.removedNodes)),a},{addedNodes:[],removedNodes:[]});c.addedNodes.length&&this.onAdded.dispatch(c.addedNodes),c.removedNodes.length&&this.onRemoved.dispatch(c.removedNodes)}},e.prototype={addEventListener:function(a,b,c){var d={type:a,callback:b,scope:c};return this._currentListeners[a]||(this._currentListeners[a]=[]),this._currentListeners[a].push(d),d},removeEventListener:function(a,b,c){var d=this._currentListeners[a]||[];this._currentListeners[a]=d.filter(function(a){var d=a.callback==b,e=a.scope==c;return!(d&&e)})},removeAllEventListeners:function(a){this._currentListeners[a]=null},hasEventListener:function(a){return this._currentListeners[a]&&this._currentListeners[a].length},dispatchEvent:function(a,b){for(var c,d,e,f=this._currentListeners[a]||[],g=f.length,h=0;g>h;h++)c=f[h],d=c.callback,e=c.scope,d.call(e,b)}},e.__instance=null,e.getInstance=function(){return e.__instance||(e.__instance=new e),e.__instance},f.prototype={equalTo:function(a,b,c){return this.eventString==b&&this.dispatcher==a&&this.listener==c}},g.prototype={mapListener:function(a,b,c,d){for(var e,g=this._listeners,h=g.length;h--;)if(e=g[h],e.equalTo(a,b,c))return;var i=c;e=new f(a,b,c,i,d),g.push(e),a.addEventListener(b,i,d)},unmapListener:function(a,b,c){for(var d=this._listeners,e=d.length;e--;){var f=d[e];if(f.equalTo(a,b,c))return a.removeEventListener(b,f.callback,f.scope),void d.splice(e,1)}},unmapListeners:function(){for(var a,b,c=this._listeners;a=c.pop();)b=a.dispatcher,b.removeEventListener(a.eventString,a.callback,a.scope)}},h.prototype={postDestroy:function(){this.eventMap.unmapListeners()},addContextListener:function(a,b,c){this.eventMap.mapListener(this.eventDispatcher,a,b,c)},removeContextListener:function(a,b){this.eventMap.unmapListener(this.eventDispatcher,a,b)},dispatch:function(a,b){this.eventDispatcher.hasEventListener(a)&&this.eventDispatcher.dispatchEvent(a,b)},initialize:function(){},destroy:function(){}},i.prototype={get:function(a){return new c(function(b){require([a],function(a){b(a)})})}},j.prototype={bootstrap:function(){return this.getMediators([document.body])},getMediators:function(b){var d=a.chain(b).reduce(this._reduceNodes,[]).reduce(this._findMediators.bind(this),[]).value();return c.all(d)},_findMediators:function(b,c){var d=a.chain(this.definitions).filter(function(a){return c.dataset&&c.dataset.mediator==a.id}).map(function(a){return this.loader.get(a.mediator).then(this._initMediator.bind(this,c))}.bind(this)).value();return b.concat(d)},_initMediator:function(a,b){var c=RoboJS.utils.nextUid();a.dataset=a.dataset||{},a.dataset.mediatorId=c;var d=new b(a);return d.id=c,RoboJS.MEDIATORS_CACHE[c]=d,d.initialize(),d},_handleNodesAdded:function(a){this.getMediators(a).then(function(a){a.length&&this.onAdded.dispatch(a)}.bind(this))},_handleNodesRemoved:function(b){a.chain(b).reduce(this._reduceNodes,[]).forEach(this._destroyMediator.bind(this))},_reduceNodes:function(a,b){if(!b||!b.getElementsByTagName)return a;var c=[].slice.call(b.getElementsByTagName("*"),0);return c.unshift(b),a.concat(c)},_destroyMediator:function(a){var b=a.dataset&&a.dataset.mediatorId,c=RoboJS.MEDIATORS_CACHE[b];c&&(c.destroy&&c.destroy(),c.postDestroy&&c.postDestroy(),c.element&&(c.element=null),this.onRemoved.dispatch(c),RoboJS.MEDIATORS_CACHE[b]=null,c=null)}},RoboJS.display={DisplayList:d,Mediator:h,MediatorsBuilder:j},RoboJS.events={EventDispatcher:e,EventMap:g,EventMapConfig:f},RoboJS.net={ScriptLoader:i,GlobalScriptLoader:{}},RoboJS});
//# sourceMappingURL=robojs.min.js.map