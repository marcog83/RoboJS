!function(t,e){if("function"==typeof define&&define.amd)define("robojs",["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var n={exports:{}};e(n.exports),t.robojs=n.exports}}(this,function(t){"use strict";function e(){this._listeners={}}function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.data=e,this.type=t,this.bubbles=n,this.cancelable=r,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1,this.target,this.currentTarget,this.eventPhase=0}function r(){function t(t,e,n){if(0===o.length)return!0;for(var r=void 0,i=0;i<o.length;i++){var u=o[i];if(u.listener===t&&u.scope===n){r=u;break}}if(!r)return!0;if(r.once!==e)throw new Error("You cannot addOnce() then add() the same listener without removing the relationship first.");return!1}function e(e,n,r){if(o||(o=[]),t(e,n,r)){var i={listener:e,scope:r,once:n};o=o.concat([i])}return o}function n(t){for(var e=o?o.length:0,n=0;n<e;n++){var i=o[n],u=i.listener,s=i.scope;i.once&&r(u,s),u.call(s,t)}}function r(t,e){for(var n=[],r=0;r<o.length;r++){var i=o[r];i.listener===t&&i.scope===e?(i.listener=null,i.scope=null,o[r]=null):n.push(i)}return o=n}function i(){return o=null}var o=[],u=function(t,n){return e(t,!1,n)},s=function(t,n){return e(t,!0,n)};return Object.freeze({connect:u,connectOnce:s,disconnect:r,disconnectAll:i,emit:n})}function i(t,e,n){return function(){for(var r=[],o=0,u=t,s=0;s<e.length||o<arguments.length;){var a;s<e.length?a=e[s]:(a=arguments[o],o+=1),r[s]=a,u-=1,s+=1}return u<=0?n.apply(this,r):d(u,i(t,r,n))}}function o(t,e){return function(){return e.call(this,t.apply(this,arguments))}}function u(t){return"[object String]"===Object.prototype.toString.call(t)}function s(t){for(var e,n,r,i=[],o=0,u=t.length;o<u;){if(_(t[o]))for(e=s(t[o]),r=0,n=e.length;r<n;)i[i.length]=e[r],r+=1;else i[i.length]=t[o];o+=1}return i}function a(t,e){return x(function(t){return t.length>0?e(t):[]},E(function(t){return t.length>0}),m(S),E(function(t){return t.querySelectorAll}),s,y(t))}Object.defineProperty(t,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=function(t,e,n){require([t],e,n)},f=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l;return Object.freeze({load:function(e){return new Promise(function(n,r){return t(e,n,r)})}})};e.prototype={addEventListener:function(t,e,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[t];return i&&this.removeEventListener(t,e,n),i=r[t],i?i.push(e):r[t]=[e],e},removeEventListener:function(t,e,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[t];if(i)for(var o=0,u=i.length;o<u;o++)if(i[o]==e){1==u?delete r[t]:i.splice(o,1);break}}},removeAllEventListeners:function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},dispatchEvent:function(t){if("string"==typeof t){var e=this._listeners;if(!e||!e[t])return!1;t=new Event(t)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(t){}if(t.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var i,o=r.length;for(i=o-1;i>=0&&!t.propagationStopped;i--)r[i]._dispatchEvent(t,1+(0==i));for(i=1;i<o&&!t.propagationStopped;i++)r[i]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return t.defaultPrevented},hasEventListener:function(t){var e=this._listeners,n=this._captureListeners;return!!(e&&e[t]||n&&n[t])},_dispatchEvent:function(t,e){var n,r=1==e?this._captureListeners:this._listeners;if(t&&r){var i=r[t.type];if(!i||!(n=i.length))return;try{t.currentTarget=this}catch(t){}try{t.eventPhase=e}catch(t){}t.removed=!1,i=i.slice();for(var o=0;o<n&&!t.immediatePropagationStopped;o++){var u=i[o];u.handleEvent?u.handleEvent(t):u(t),t.removed&&(this.removeEventListener(t.type,u,1==e),t.removed=!1)}}}};var h=new e,p=function(){return new e};n.prototype={preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.propagationStopped=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},remove:function(){this.removed=!0},clone:function(){return new n(this.type,this.data,this.bubbles,this.cancelable)}};var d=function(t,e){switch(t){case 0:return function(){return e.apply(this,arguments)};case 1:return function(t){return e.apply(this,arguments)};case 2:return function(t,n){return e.apply(this,arguments)};case 3:return function(t,n,r){return e.apply(this,arguments)};case 4:return function(t,n,r,i){return e.apply(this,arguments)};case 5:return function(t,n,r,i,o){return e.apply(this,arguments)};case 6:return function(t,n,r,i,o,u){return e.apply(this,arguments)};case 7:return function(t,n,r,i,o,u,s){return e.apply(this,arguments)};case 8:return function(t,n,r,i,o,u,s,a){return e.apply(this,arguments)};case 9:return function(t,n,r,i,o,u,s,a,c){return e.apply(this,arguments)};case 10:return function(t,n,r,i,o,u,s,a,c,l){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}},v=function(t){return function e(n){return 0===arguments.length?e:t.apply(this,arguments)}},g=function(t){var e=t.length;return 1===e?v(t):d(e,i(e,[],t))},m=g(function(t,e){var n=0,r=e.length,i=[];for(n;n<r;n++)i[n]=t(e[n]);return i}),y=g(function(t,e){return m(function(e){return e[t]},e)}),b=g(function(t,e,n){for(var r=0,i=n.length;r<i;)e=t(e,n[r]),r+=1;return e}),x=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];e.reverse();var r=e[0],i=e.slice(1);return d(r.length,b(o,r,i))},_=function(t){return!!Array.isArray(t)||!!t&&("object"===(void 0===t?"undefined":c(t))&&(!u(t)&&(1===t.nodeType?!!t.length:0===t.length||t.length>0&&(t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1)))))},E=g(function(t,e){for(var n=0,r=e.length,i=[];n<r;)t(e[n])&&(i[i.length]=e[n]),n+=1;return i}),S=function(t){var e=[].slice.call(t.querySelectorAll("[data-mediator]"),0);return t.getAttribute("data-mediator")&&e.unshift(t),e},A=function(t){function e(){c.disconnect(),n.disconnectAll(),i.disconnectAll(),c=null,n=null,i=null,o=null,u=null}var n=r(),i=r(),o=a("addedNodes",n.emit),u=a("removedNodes",i.emit),s=function(t){u(t),o(t)},c=new MutationObserver(s);return c.observe(t,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),Object.freeze({onAdded:n,onRemoved:i,dispose:e})},L="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",w=function(){return L.replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},P=function(t){return t},O=g(function(t,e,n){var r=w();return t.setAttribute("mediatorid",r),{mediatorId:r,node:t,dispose:n(t,e)||P}}),j=g(function(t,e){for(var n=0,r=e.length;n<r;){if(t(e[n]))return e[n];n+=1}}),M=function(t,e){return!!j(function(t){return t.node===e},t)},D=function(t,e,n){return g(function(r,i,o){return i(t(o)).then(e(o,r)).then(n)})},z=g(function(t,e){return t[e.getAttribute("data-mediator")]}),T=function(t){function e(t){for(var e=0;e<c.length;e++){var n=c[e];n&&n.node===t&&(n.dispose(),n.node=null,c[e]=null,c.splice(e,1))}return c}function n(){c.forEach(function(t){t&&(t.dispose(),t.node=null)}),c=null,a.removeAllEventListeners(),a=null,f=null,u=null,l=null}function r(t){return c.push(t),c}function i(t){return!!l(t)&&!M(c,t)}var o=t.definitions,u=void 0===o?{}:o,s=t.dispatcher,a=void 0===s?p():s,c=[],l=z(u),f=D(l,O,r);return Object.freeze({dispose:n,destroy:e,findMediator:f(a),hasMediator:i,getAllElements:S})},k=function(t,e){return x(function(t){return Promise.all(t)},m(t),E(e),s)},q=g(function(t,e){for(var n=e.length,r=0;r<n;)t(e[r]),r+=1;return e}),R=function(t){return x(q(t),s)},H=function(t,e){return x(t,m(e),function(t){return[t]})},I=function(t){var e=t.definitions,n=t.loader,r=void 0===n?f():n,i=t.root,o=void 0===i?document.body:i,u=t.mediatorHandler||T({definitions:e}),s=t.domWatcher||A(o),a=k(u.findMediator(r.load),u.hasMediator);s.onAdded.connect(a),s.onRemoved.connect(R(u.destroy));var c=H(a,u.getAllElements)(o);return{promise:c,dispose:function(){s.dispose(),u.dispose(),s=null,u=null,a=null,e=null,r=null,o=null,c=null}}};t.bootstrap=I,t.MediatorHandler=T,t.DomWatcher=A,t.Signal=r,t.RJSEvent=n,t.makeDispatcher=p,t.EventDispatcher=h,t.Loader=f});