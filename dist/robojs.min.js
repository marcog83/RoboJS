!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.robojs=e.robojs||{})}(this,function(e){"use strict";function t(e){var t=function(){return System.import?function(e){return System.import(e)}:function(e){return Promise.resolve(System.get(e))}};return t()(e).then(function(e){return e.default?e.default:e}).catch(function(e){console.log(e)})}function n(){function e(e,t,n){if(0===o.length)return!0;for(var r=void 0,i=0;i<o.length;i++){var u=o[i];if(u.listener===e&&u.scope===n){r=u;break}}if(!r)return!0;if(r.once!==t)throw new Error("You cannot addOnce() then add() the same listener without removing the relationship first.");return!1}function t(t,n,r){if(e(t,n,r)){var i={listener:t,scope:r,once:n};o=o.concat([i])}return o}function n(e){for(var t=o.length,n=0;n<t;n++){var i=o[n],u=i.listener,a=i.scope,s=i.once;s&&r(u,a),u.call(a,e)}}function r(e,t){for(var n=[],r=0;r<o.length;r++){var i=o[r];i.listener===e&&i.scope===t||n.push(i)}return o=n}function i(){return o=[]}var o=[],u=function(e,n){return t(e,!1,n)},a=function(e,n){return t(e,!0,n)};return Object.freeze({connect:u,connectOnce:a,disconnect:r,disconnectAll:i,emit:n})}function r(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,i){return t.apply(this,arguments)};case 5:return function(e,n,r,i,o){return t.apply(this,arguments)};case 6:return function(e,n,r,i,o,u){return t.apply(this,arguments)};case 7:return function(e,n,r,i,o,u,a){return t.apply(this,arguments)};case 8:return function(e,n,r,i,o,u,a,s){return t.apply(this,arguments)};case 9:return function(e,n,r,i,o,u,a,s,c){return t.apply(this,arguments)};case 10:return function(e,n,r,i,o,u,a,s,c,f){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function i(e,t,n){return function(){for(var o=[],u=0,a=e,s=0;s<t.length||u<arguments.length;){var c;s<t.length?c=t[s]:(c=arguments[u],u+=1),o[s]=c,a-=1,s+=1}return a<=0?n.apply(this,o):r(a,i(e,o,n))}}function o(e){return function t(n){return 0===arguments.length?t:e.apply(this,arguments)}}function u(e){var t=e.length;return 1===t?o(e):r(t,i(t,[],e))}function a(e){return"[object String]"===Object.prototype.toString.call(e)}function s(e){return!!Array.isArray(e)||!!e&&("object"==typeof e&&(!a(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))}function c(e){for(var t,n,r,i=[],o=0,u=e.length;o<u;){if(s(e[o]))for(t=c(e[o]),r=0,n=t.length;r<n;)i[i.length]=t[r],r+=1;else i[i.length]=e[o];o+=1}return i}function f(e,t){return E(function(e){return e.length>0?t(e):[]},w(function(e){return e.length>0}),_(S),w(function(e){return e.querySelectorAll}),c,A(e))}function l(e,t,n){var r=j();e.setAttribute("mediatorid",r);var i=n(e,t)||O;return{mediatorId:r,node:e,dispose:i}}var h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;return Object.freeze({load:e})},d=function(e,t,n){window.require([e],t,n)},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return Object.freeze({load:function(t){return new Promise(function(n,r){return e(t,n,r)})}})},v=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];v(this,e),this.data=n,this.type=t,this.bubbles=r,this.cancelable=i,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1,this.target,this.currentTarget,this.eventPhase=0}return g(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"remove",value:function(){this.removed=!0}},{key:"clone",value:function(){return new e(this.type,this.data,this.bubbles,this.cancelable)}}]),e}(),m=function(){function e(){v(this,e),this._listeners={}}return g(e,[{key:"addEventListener",value:function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t}},{key:"removeEventListener",value:function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var o=0,u=i.length;o<u;o++)if(i[o]==t){1==u?delete r[e]:i.splice(o,1);break}}}},{key:"removeAllEventListeners",value:function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null}},{key:"dispatchEvent",value:function(e){if("string"==typeof e){var t=this._listeners;if(!t||!t[e])return!1;e=new y(e)}else e.target&&e.clone&&(e=e.clone());try{e.target=this}catch(e){}if(e.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var i,o=r.length;for(i=o-1;i>=0&&!e.propagationStopped;i--)r[i]._dispatchEvent(e,1+(0==i));for(i=1;i<o&&!e.propagationStopped;i++)r[i]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented}},{key:"hasEventListener",value:function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])}},{key:"_dispatchEvent",value:function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;try{e.currentTarget=this}catch(e){}try{e.eventPhase=t}catch(e){}e.removed=!1,i=i.slice();for(var o=0;o<n&&!e.immediatePropagationStopped;o++){var u=i[o];u.handleEvent?u.handleEvent(e):u(e),e.removed&&(this.removeEventListener(e.type,u,1==t),e.removed=!1)}}}}]),e}(),b=new m,x=function(){return new m},_=u(function(e,t){return Array.from(t).map(e)}),A=u(function(e,t){return _(function(t){return t[e]},t)}),E=function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];n.reverse();var o=n[0],u=n.slice(1);return r(o.length,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return u.reduce(function(t,n){return n.call(e,t)},o.apply(e,n))})},w=u(function(e,t){return Array.from(t).filter(e)}),S=function(e){var t=[];return e.getAttribute("data-mediator")&&t.push(e),t.concat(Array.from(e.querySelectorAll("[data-mediator]")))},L=function(e){function t(){s.disconnect(),r.disconnectAll(),i.disconnectAll()}var r=n(),i=n(),o=f("addedNodes",r.emit),u=f("removedNodes",i.emit),a=function(e){u(e),o(e)},s=new MutationObserver(a);return s.observe(e,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),Object.freeze({onAdded:r,onRemoved:i,dispose:t})},P=/[xy]/g,k="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",j=function(){return k.replace(P,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})},O=function(e){return e},M=u(l),D=u(function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return t[n];n+=1}}),z=function(e,t){return!!D(function(e){return e.node===t},e)},T=function(e,t,n){return u(function(r,i,o){return i(e(o)).then(t(o,r)).then(n)})},q=u(function(e,t){return e[t.getAttribute("data-mediator")]}),R=function(e){function t(e){for(var t=0;t<c.length;t++){var n=c[t];n&&n.node===e&&(n.dispose(),n.node=null,c[t]=null)}return c=c.filter(function(e){return e})}function n(){c.forEach(function(e){e&&(e.dispose(),e.node=null)}),c=[],s.removeAllEventListeners()}function r(e){return c.push(e),c}function i(e){return!!f(e)&&!z(c,e)}var o=e.definitions,u=void 0===o?{}:o,a=e.dispatcher,s=void 0===a?x():a,c=[],f=q(u),l=T(f,M,r);return Object.freeze({dispose:n,destroy:t,findMediator:l(s),hasMediator:i,getAllElements:S})},H=function(e,t){return E(function(e){return Promise.all(e)},_(e),w(t),c)},I=u(function(e,t){for(var n=t.length,r=0;r<n;)e(t[r]),r+=1;return t}),N=function(e){return E(I(e),c)},W=function(e){return E(e,_(S),function(e){return[e]})},C=function(e){var t=e.definitions,n=e.loader,r=void 0===n?h():n,i=e.root,o=void 0===i?document.body:i,u=e.mediatorHandler||R({definitions:t}),a=e.domWatcher||L(o),s=H(u.findMediator(r.load),u.hasMediator);a.onAdded.connect(s),a.onRemoved.connect(N(u.destroy));var c=W(s);return{promise:c(o),dispose:function(){a.dispose(),u.dispose()}}};e.bootstrap=C,e.MediatorHandler=R,e.DomWatcher=L,e.Signal=n,e.RJSEvent=y,e.makeDispatcher=x,e.EventDispatcher=b,e.Loader=h,e.AmdLoader=p,Object.defineProperty(e,"__esModule",{value:!0})});