/*! robojs 0.20.0 (RoboJS Build) | MIT */
!function(a,b){"function"==typeof define&&define.amd?define("robojs",["Promise"],b):a.RoboJS=b(a.Promise)}(this,function(a){"use strict";function b(){this.listenerBoxes=[],this._valueClasses=null,this.listenersNeedCloning=!1,this.setValueClasses(arguments)}function c(){this.onAdded=new b,this.onRemoved=new b;var a=new MutationObserver(this.handleMutations.bind(this));a.observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}function d(a,b){this.eventMap=b,this.eventDispatcher=a}function e(a,c,d,e){this.onAdded=new b,this.onRemoved=new b,this.definitions=e||[],this.displayList=a,this.mediatorHandler=d,this.displayList.onAdded.connect(this._handleNodesAdded,this),this.displayList.onRemoved.connect(this._handleNodesRemoved,this),this.loader=c}function f(){}function g(){this._currentListeners={}}function h(a,b,c,d,e){this.dispatcher=a,this.eventString=b,this.listener=c,this.callback=d,this.scope=e}function i(){this._listeners=[]}function j(){}function k(a){a.autoplay=void 0==a.autoplay?!0:a.autoplay;var b=new c,d=new f,g=new j,h=new e(b,d,g,a.definitions);return a.autoplay?h.bootstrap():h}var RoboJS={MEDIATORS_CACHE:{},utils:{uid:["0","0","0"],nextUid:function(){for(var a,b=this.uid.length;b;){if(b--,a=this.uid[b].charCodeAt(0),57==a)return this.uid[b]="A",this.uid.join("");if(90!=a)return this.uid[b]=String.fromCharCode(a+1),this.uid.join("");this.uid[b]="0"}return this.uid.unshift("0"),this.uid.join("")}}};return b.prototype={getNumListeners:function(){return this.listenerBoxes.length},getValueClasses:function(){return this._valueClasses},connect:function(a,b){this.registerListener(a,b,!1)},connectOnce:function(a,b){this.registerListener(a,b,!0)},disconnect:function(a,b){this.listenersNeedCloning&&(this.listenerBoxes=this.listenerBoxes.slice(),this.listenersNeedCloning=!1);for(var c=this.listenerBoxes.length;c--;)if(this.listenerBoxes[c].listener==a&&this.listenerBoxes[c].scope==b)return void this.listenerBoxes.splice(c,1)},disconnectAll:function(){for(var a=this.listenerBoxes.length;a--;)this.disconnect(this.listenerBoxes[a].listener,this.listenerBoxes[a].scope)},emit:function(){for(var a,b=0;b<this._valueClasses.length;b++)if(!this.primitiveMatchesValueClass(arguments[b],this._valueClasses[b])&&!(null==(a=arguments[b])||a instanceof this._valueClasses[b]))throw new Error("Value object <"+a+"> is not an instance of <"+this._valueClasses[b]+">.");var c,d=this.listenerBoxes,e=d.length;this.listenersNeedCloning=!0;for(var f=0;e>f;f++)c=d[f],c.once&&this.disconnect(c.listener,c.scope),c.listener.apply(c.scope,arguments);this.listenersNeedCloning=!1},primitiveMatchesValueClass:function(a,b){return"string"==typeof a&&b==String||"number"==typeof a&&b==Number||"boolean"==typeof a&&b==Boolean?!0:!1},setValueClasses:function(a){this._valueClasses=a||[];for(var b=this._valueClasses.length;b--;)if(!(this._valueClasses[b]instanceof Function))throw new Error("Invalid valueClasses argument: item at index "+b+" should be a Class but was:<"+this._valueClasses[b]+">.")},registerListener:function(a,b,c){for(var d=0;d<this.listenerBoxes.length;d++)if(this.listenerBoxes[d].listener==a&&this.listenerBoxes[d].scope==b){if(this.listenerBoxes[d].once&&!c)throw new Error("You cannot addOnce() then try to add() the same listener without removing the relationship first.");if(c&&!this.listenerBoxes[d].once)throw new Error("You cannot add() then addOnce() the same listener without removing the relationship first.");return}this.listenersNeedCloning&&(this.listenerBoxes=this.listenerBoxes.slice()),this.listenerBoxes.push({listener:a,scope:b,once:c})}},c.prototype={handleMutations:function(a){var b=a.reduce(function(a,b){return a.addedNodes=a.addedNodes.concat(Array.prototype.slice.call(b.addedNodes)),a.removedNodes=a.removedNodes.concat(Array.prototype.slice.call(b.removedNodes)),a},{addedNodes:[],removedNodes:[]});b.addedNodes.length&&this.onAdded.emit(b.addedNodes),b.removedNodes.length&&this.onRemoved.emit(b.removedNodes)}},d.inherit=function(a,b){d.apply(a,Array.prototype.slice.call(b,-2))},d.prototype={postDestroy:function(){this.eventMap.unmapListeners()},addContextListener:function(a,b,c){this.eventMap.mapListener(this.eventDispatcher,a,b,c)},removeContextListener:function(a,b){this.eventMap.unmapListener(this.eventDispatcher,a,b)},dispatch:function(a,b){this.eventDispatcher.hasEventListener(a)&&this.eventDispatcher.dispatchEvent(a,b)},initialize:function(a){this.element=a},destroy:function(){}},e.prototype={bootstrap:function(){return this.getMediators([document.body])},getMediators:function(b){return a.all(b.reduce(this._reduceNodes,[]).reduce(this._findMediators.bind(this),[]))},_findMediators:function(a,b){return a.concat(this.definitions.filter(function(a){return b.dataset&&b.dataset.mediator==a.id}).map(function(a){return this.loader.get(a.mediator).then(this._initMediator.bind(this,b))}.bind(this)))},_initMediator:function(a,b){return this.mediatorHandler.create(a,b)},_handleNodesAdded:function(a){this.getMediators(a).then(function(a){a.length&&this.onAdded.emit(a)}.bind(this))},_handleNodesRemoved:function(a){a.reduce(this._reduceNodes,[]).forEach(this._destroyMediator.bind(this))},_reduceNodes:function(a,b){if(!b||!b.getElementsByTagName)return a;var c=[].slice.call(b.getElementsByTagName("*"),0);return c.unshift(b),a.concat(c)},_destroyMediator:function(a){var b=this.mediatorHandler.destroy(a);b&&this.onRemoved.emit(b)}},f.prototype={get:function(b){return new a(function(a){require([b],function(b){a(b)})})}},g.prototype={addEventListener:function(a,b,c){var d={type:a,callback:b,scope:c};return this._currentListeners[a]||(this._currentListeners[a]=[]),this._currentListeners[a].push(d),d},removeEventListener:function(a,b,c){var d=this._currentListeners[a]||[];this._currentListeners[a]=d.filter(function(a){var d=a.callback==b,e=a.scope==c;return!(d&&e)})},removeAllEventListeners:function(a){this._currentListeners[a]=null},hasEventListener:function(a){return this._currentListeners[a]&&this._currentListeners[a].length},dispatchEvent:function(a,b){for(var c,d,e,f=this._currentListeners[a]||[],g=f.length,h=0;g>h;h++)c=f[h],d=c.callback,e=c.scope,d.call(e,b)}},g.__instance=null,g.getInstance=function(){return g.__instance||(g.__instance=new g),g.__instance},h.prototype={equalTo:function(a,b,c){return this.eventString==b&&this.dispatcher==a&&this.listener==c}},i.prototype={mapListener:function(a,b,c,d){for(var e,f=this._listeners,g=f.length;g--;)if(e=f[g],e.equalTo(a,b,c))return;var i=c;e=new h(a,b,c,i,d),f.push(e),a.addEventListener(b,i,d)},unmapListener:function(a,b,c){for(var d=this._listeners,e=d.length;e--;){var f=d[e];if(f.equalTo(a,b,c))return a.removeEventListener(b,f.callback,f.scope),void d.splice(e,1)}},unmapListeners:function(){for(var a,b,c=this._listeners;a=c.pop();)b=a.dispatcher,b.removeEventListener(a.eventString,a.callback,a.scope)}},j.prototype={create:function(a,b){var c=RoboJS.utils.nextUid();a.dataset=a.dataset||{},a.dataset.mediatorId=c;var d=new b(g.getInstance(),new i);return d.id=c,RoboJS.MEDIATORS_CACHE[c]=d,d.initialize(a),d},destroy:function(a){var b=a.dataset&&a.dataset.mediatorId,c=RoboJS.MEDIATORS_CACHE[b];c&&(c.destroy&&c.destroy(),c.postDestroy&&c.postDestroy(),c.element&&(c.element=null),RoboJS.MEDIATORS_CACHE[b]=null,c=null)}},RoboJS.display={DisplayList:c,Mediator:d,bootstrap:k,MediatorsBuilder:e},RoboJS.events={EventDispatcher:g,EventMap:i,EventMapConfig:h,Signal:b},RoboJS.net={ScriptLoader:f},RoboJS});
//# sourceMappingURL=robojs.min.js.map