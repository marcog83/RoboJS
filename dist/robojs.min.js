!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.robojs=e.robojs||{})}(this,function(e){"use strict";function t(){function e(e,t,n){if(0===o.length)return!0;for(var r=void 0,i=0;i<o.length;i++){var u=o[i];if(u.listener===e&&u.scope===n){r=u;break}}if(!r)return!0;if(r.once!==t)throw new Error("You cannot addOnce() then add() the same listener without removing the relationship first.");return!1}function t(t,n,r){if(e(t,n,r)){var i={listener:t,scope:r,once:n};o=o.concat([i])}return o}function n(e){for(var t=o.length,n=0;n<t;n++){var i=o[n],u=i.listener,a=i.scope;i.once&&r(u,a),u.call(a,e)}}function r(e,t){for(var n=[],r=0;r<o.length;r++){var i=o[r];i.listener===e&&i.scope===t||n.push(i)}return o=n}function i(){return o=[]}var o=[],u=function(e,n){return t(e,!1,n)},a=function(e,n){return t(e,!0,n)};return Object.freeze({connect:u,connectOnce:a,disconnect:r,disconnectAll:i,emit:n})}function n(e,t,r){return function(){for(var i=[],o=0,u=e,a=0;a<t.length||o<arguments.length;){var s;a<t.length?s=t[a]:(s=arguments[o],o+=1),i[a]=s,u-=1,a+=1}return u<=0?r.apply(this,i):v(u,n(e,i,r))}}function r(e,t){return function(){return t.call(this,e.apply(this,arguments))}}function i(e){return"[object String]"===Object.prototype.toString.call(e)}function o(e){for(var t,n,r,i=[],u=0,a=e.length;u<a;){if(E(e[u]))for(t=o(e[u]),r=0,n=t.length;r<n;)i[i.length]=t[r],r+=1;else i[i.length]=e[u];u+=1}return i}function u(e,t){return _(function(e){return e.length>0?t(e):[]},w(function(e){return e.length>0}),m(L),w(function(e){return e.querySelectorAll}),o,b(e))}var a=function(e,t,n){require([e],t,n)},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;return Object.freeze({load:function(t){return new Promise(function(n,r){return e(t,n,r)})}})},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function(){function e(){c(this,e),this._listeners={}}return l(e,[{key:"addEventListener",value:function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t}},{key:"removeEventListener",value:function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var o=0,u=i.length;o<u;o++)if(i[o]==t){1==u?delete r[e]:i.splice(o,1);break}}}},{key:"removeAllEventListeners",value:function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null}},{key:"dispatchEvent",value:function(e){if("string"==typeof e){var t=this._listeners;if(!t||!t[e])return!1;e=new Event(e)}else e.target&&e.clone&&(e=e.clone());try{e.target=this}catch(e){}if(e.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var i,o=r.length;for(i=o-1;i>=0&&!e.propagationStopped;i--)r[i]._dispatchEvent(e,1+(0==i));for(i=1;i<o&&!e.propagationStopped;i++)r[i]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented}},{key:"hasEventListener",value:function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])}},{key:"_dispatchEvent",value:function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;try{e.currentTarget=this}catch(e){}try{e.eventPhase=t}catch(e){}e.removed=!1,i=i.slice();for(var o=0;o<n&&!e.immediatePropagationStopped;o++){var u=i[o];u.handleEvent?u.handleEvent(e):u(e),e.removed&&(this.removeEventListener(e.type,u,1==t),e.removed=!1)}}}}]),e}(),h=new f,d=function(){return new f},p=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];c(this,e),this.data=n,this.type=t,this.bubbles=r,this.cancelable=i,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1,this.target,this.currentTarget,this.eventPhase=0}return l(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"remove",value:function(){this.removed=!0}},{key:"clone",value:function(){return new e(this.type,this.data,this.bubbles,this.cancelable)}}]),e}(),v=function(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,i){return t.apply(this,arguments)};case 5:return function(e,n,r,i,o){return t.apply(this,arguments)};case 6:return function(e,n,r,i,o,u){return t.apply(this,arguments)};case 7:return function(e,n,r,i,o,u,a){return t.apply(this,arguments)};case 8:return function(e,n,r,i,o,u,a,s){return t.apply(this,arguments)};case 9:return function(e,n,r,i,o,u,a,s,c){return t.apply(this,arguments)};case 10:return function(e,n,r,i,o,u,a,s,c,l){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}},g=function(e){return function t(n){return 0===arguments.length?t:e.apply(this,arguments)}},y=function(e){var t=e.length;return 1===t?g(e):v(t,n(t,[],e))},m=y(function(e,t){var n=0,r=t.length,i=[];for(n;n<r;n++)i[n]=e(t[n]);return i}),b=y(function(e,t){return m(function(t){return t[e]},t)}),x=y(function(e,t,n){for(var r=0,i=n.length;r<i;)t=e(t,n[r]),r+=1;return t}),_=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.reverse();var i=t[0],o=t.slice(1);return v(i.length,x(r,i,o))},E=function(e){return!!Array.isArray(e)||!!e&&("object"==typeof e&&(!i(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))},w=y(function(e,t){for(var n=0,r=t.length,i=[];n<r;)e(t[n])&&(i[i.length]=t[n]),n+=1;return i}),L=function(e){var t=[].slice.call(e.querySelectorAll("[data-mediator]"),0);return e.getAttribute("data-mediator")&&t.unshift(e),t},A=function(e){function n(){c.disconnect(),r.disconnectAll(),i.disconnectAll()}var r=t(),i=t(),o=u("addedNodes",r.emit),a=u("removedNodes",i.emit),s=function(e){a(e),o(e)},c=new MutationObserver(s);return c.observe(e,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),Object.freeze({onAdded:r,onRemoved:i,dispose:n})},P="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",S=function(){return P.replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},k=function(e){return e},j=y(function(e,t,n){var r=S();return e.setAttribute("mediatorid",r),{mediatorId:r,node:e,dispose:n(e,t)||k}}),O=y(function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return t[n];n+=1}}),M=function(e,t){return!!O(function(e){return e.node===t},e)},D=function(e,t,n){return y(function(r,i,o){return i(e(o)).then(t(o,r)).then(n)})},T=y(function(e,t){return e[t.getAttribute("data-mediator")]}),z=function(e){function t(e){for(var t=0;t<c.length;t++){var n=c[t];n&&n.node===e&&(n.dispose(),n.node=null,c[t]=null,c.splice(t,1))}return c}function n(){c.forEach(function(e){e&&(e.dispose(),e.node=null)}),c=[],s.removeAllEventListeners()}function r(e){return c.push(e),c}function i(e){return!!l(e)&&!M(c,e)}var o=e.definitions,u=void 0===o?{}:o,a=e.dispatcher,s=void 0===a?d():a,c=[],l=T(u),f=D(l,j,r);return Object.freeze({dispose:n,destroy:t,findMediator:f(s),hasMediator:i,getAllElements:L})},q=function(e,t){return _(function(e){return Promise.all(e)},m(e),w(t),o)},R=y(function(e,t){for(var n=t.length,r=0;r<n;)e(t[r]),r+=1;return t}),H=function(e){return _(R(e),o)},I=function(e){return _(e,m(L),function(e){return[e]})},N=function(e){var t=e.definitions,n=e.loader,r=void 0===n?s():n,i=e.root,o=void 0===i?document.body:i,u=e.mediatorHandler||z({definitions:t}),a=e.domWatcher||A(o),c=q(u.findMediator(r.load),u.hasMediator);return a.onAdded.connect(c),a.onRemoved.connect(H(u.destroy)),{promise:I(c)(o),dispose:function(){a.dispose(),u.dispose()}}};e.bootstrap=N,e.MediatorHandler=z,e.DomWatcher=A,e.Signal=t,e.RJSEvent=p,e.makeDispatcher=d,e.EventDispatcher=h,e.Loader=s,Object.defineProperty(e,"__esModule",{value:!0})});