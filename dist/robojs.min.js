!function(t,e){if("function"==typeof define&&define.amd)define("robojs",["exports"],e);else if("undefined"!=typeof exports)e(exports);else{var n={};e(n),t.robojs=n}}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var e=function(){function t(){}return t.prototype.load=function(n){var r=this;return new Promise(function(t,e){return r.onComplete(n,t,e)})},t.prototype.onComplete=function(t,e,n){},t}(),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.onComplete=function(t,e,n){require([t],e,n)},e}(e),r=function(n){function t(t){var e=n.call(this)||this;return e.fn=t,e}return i(t,n),t.prototype.onComplete=function(t,e,n){this.fn(t,e,n)},t}(e),o=function(){function t(){this.listeners_={}}return t.prototype.addEventListener=function(t,e){if(t in this.listeners_){var n=this.listeners_[t];n.indexOf(e)<0&&n.push(e)}else this.listeners_[t]=[e]},t.prototype.removeEventListener=function(t,e){if(t in this.listeners_){var n=this.listeners_[t],r=n.indexOf(e);0<=r&&(1===n.length?delete this.listeners_[t]:n.splice(r,1))}},t.prototype.dispatchEvent=function(t){var e=this;t.__defineGetter__("target",function(){return e});var n=t.type,r=0;if(n in this.listeners_)for(var i=this.listeners_[n].concat(),o=0;o<i.length;o++){var s=i[o];s.handleEvent?r|=!1===s.handleEvent.call(s,t):r|=!1===s.call(this,t)}return!r&&!t.defaultPrevented},t}(),a=(("undefined"==typeof global?"undefined":n(global))===n(null)?global:self).EventTarget;try{new a}catch(t){a=o}var u=a,l=function(){function t(){this.listenerBoxes=[],this.listenersNeedCloning=!1}return t.prototype.getNumListeners=function(){return this.listenerBoxes.length},t.prototype.connect=function(t,e){this.registerListener(t,e,!1)},t.prototype.connectOnce=function(t,e){this.registerListener(t,e,!0)},t.prototype.disconnect=function(t,e){this.listenersNeedCloning&&(this.listenerBoxes=this.listenerBoxes.slice(),this.listenersNeedCloning=!1);for(var n=this.listenerBoxes.length;n--;)if(this.listenerBoxes[n].listener==t&&this.listenerBoxes[n].scope==e)return void this.listenerBoxes.splice(n,1)},t.prototype.disconnectAll=function(){for(var t=this.listenerBoxes.length;t--;)this.disconnect(this.listenerBoxes[t].listener,this.listenerBoxes[t].scope)},t.prototype.emit=function(){for(var r=this,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];this.listenersNeedCloning=!0,this.listenerBoxes.forEach(function(t){var e=t.scope,n=t.listener;t.once&&r.disconnect(n,e),n.apply(e,i)}),this.listenersNeedCloning=!1},t.prototype.registerListener=function(e,n,r){var t=this.listenerBoxes.filter(function(t){return t.listener===e&&t.scope===n});if(t.length){var i=t.find(function(t){return t.once&&!r}),o=t.find(function(t){return r&&!t.once});if(i)throw Error("You cannot addOnce() then try to add() the same listener without removing the relationship first.");if(o)throw Error("You cannot add() then addOnce() the same listener without removing the relationship first.")}else this.listenersNeedCloning&&(this.listenerBoxes=this.listenerBoxes.slice()),this.listenerBoxes.push({listener:e,scope:n,once:r})},t}();function h(t,h){switch(t){case 0:return function(){return h.apply(this,arguments)};case 1:return function(t){return h.apply(this,arguments)};case 2:return function(t,e){return h.apply(this,arguments)};case 3:return function(t,e,n){return h.apply(this,arguments)};case 4:return function(t,e,n,r){return h.apply(this,arguments)};case 5:return function(t,e,n,r,i){return h.apply(this,arguments)};case 6:return function(t,e,n,r,i,o){return h.apply(this,arguments)};case 7:return function(t,e,n,r,i,o,s){return h.apply(this,arguments)};case 8:return function(t,e,n,r,i,o,s,a){return h.apply(this,arguments)};case 9:return function(t,e,n,r,i,o,s,a,u){return h.apply(this,arguments)};case 10:return function(t,e,n,r,i,o,s,a,u,l){return h.apply(this,arguments)};default:throw Error("First argument to _arity must be a non-negative integer no greater than ten")}}var c=function(t){return t};function d(t){var e,n=t.length;return 1===n?(e=t,function t(){return 0===arguments.length?t:e.apply(this,arguments)}):h(n,function o(s,a,u){return function(){for(var t=[],e=0,n=s,r=0;r<a.length||e<arguments.length;){var i=void 0;r<a.length?i=a[r]:(i=arguments[e],e+=1),t[r]=i,n-=1,r+=1}return n<=0?u.apply(this,t):h(n,o(s,t,u))}}(n,[],t))}d(function(t,e,n){for(var r=0,i=n.length;r<i;)e=t(e,n[r]),r+=1;return e}),d(function(t,e){for(var n=0,r=e.length,i=[];n<r;)t(e[n])&&(i[i.length]=e[n]),n+=1;return i}),d(function(t,e){for(var n=0,r=e.length;n<r;){if(t(e[n]))return e[n];n+=1}});var p=function(t){return null!=t&&0<=t.length&&"[object Array]"===Object.prototype.toString.call(t)};function f(t){var e;return!!t&&(!!(Array.isArray||p)(t)||"object"===(void 0===t?"undefined":n(t))&&(e=t,"[object String]"!==Object.prototype.toString.call(e)&&(1===t.nodeType?!!t.length:0===t.length||0<t.length&&(t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1)))))}function y(t){for(var e,n,r,i=[],o=0,s=t.length;o<s;){if(f(t[o]))for(r=0,n=(e=y(t[o])).length;r<n;)i[i.length]=e[r],r+=1;else i[i.length]=t[o];o+=1}return i}d(function(t,e){for(var n=e.length,r=0;r<n;)t(e[r]),r+=1;return e});var m=d(function(t,e){for(var n=0,r=e.length,i=[];n<r;n++)i[n]=t(e[n]);return i});function g(t){return t.filter(function(t,e,n){return n.indexOf(t)==e})}d(function(e,t){return m(function(t){return t[e]},t)});var v=function(){function t(t,e){this.onAdded=new l,this.onRemoved=new l,this.root=t,this.getAllElements=e,this.init()}return t.prototype.init=function(){this.observer=new MutationObserver(this.handleMutations.bind(this)),this.observer.observe(this.root,{attributes:!1,childList:!0,characterData:!1,subtree:!0})},t.prototype.handleMutations=function(t){var e=this;t.forEach(function(t){e.getRemoved(t.removedNodes),e.getAdded(t.addedNodes)})},t.prototype.getAdded=function(t){var e=y(t);return 0<(e=g(e=y(e=e.filter(function(t){return t.querySelectorAll}).map(this.getAllElements).filter(function(t){return 0<t.length})))).length?this.onAdded.emit(e):[]},t.prototype.getRemoved=function(t){var e=y(t);return 0<(e=g(e=y(e=e.filter(function(t){return t.querySelectorAll}).map(this.getAllElements).filter(function(t){return 0<t.length})))).length?this.onRemoved.emit(e):[]},t.prototype.dispose=function(){this.observer.disconnect(),this.onAdded.disconnectAll(),this.onRemoved.disconnectAll(),this.observer=null,this.onAdded=null,this.onRemoved=null},t}(),E=/[xy]/g,b=function(){function t(t){var e=t.definitions,n=void 0===e?{}:e,r=t.dispatcher,i=void 0===r?new u:r;this.definitions=n,this.dispatcher=i}return t.prototype.getDefinition=function(t){},t.prototype.inCache=function(t){return!1},t.prototype.updateCache=function(t){},t.prototype.hasMediator=function(t){return!1},t.prototype.findMediator=function(t,e){var n=this;return t(this.getDefinition(e)).then(function(t){return n.create(e,t)}).then(this.updateCache.bind(this))},t.prototype.create=function(t,e){throw Error("not implemented")},t.prototype.getAllElements=function(t){},t.prototype.destroy=function(t){},t.prototype.dispose=function(){},t}(),A=function(n){function t(t){void 0===t&&(t={});var e=n.call(this,t)||this;return e.MEDIATORS_CACHE=[],e}return i(t,n),Object.defineProperty(t.prototype,"selector",{get:function(){return"data-mediator"},enumerable:!0,configurable:!0}),t.prototype.getDefinition=function(t){return this.definitions[t.getAttribute(this.selector)]},t.prototype.inCache=function(e){return!!this.MEDIATORS_CACHE.find(function(t){return t.node===e})},t.prototype.updateCache=function(t){return this.MEDIATORS_CACHE.push(t),this.MEDIATORS_CACHE},t.prototype.hasMediator=function(t){return!!this.getDefinition(t)&&!this.inCache(t)},t.prototype.findMediator=function(t,e){var n=this;return t(this.getDefinition(e)).then(function(t){return n.create(e,t)}).then(this.updateCache.bind(this))},t.prototype.create=function(t,e){var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(E,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)});t.setAttribute("mediatorid",n);var r={mediatorId:n,node:t,dispose:c};t.parentNode&&(r={mediatorId:n,node:t,dispose:e(t,this.dispatcher)||c});return r},t.prototype.getAllElements=function(t){var e=[].slice.call(t.querySelectorAll("["+this.selector+"]"),0);return t.getAttribute(this.selector)&&e.unshift(t),e},t.disposeMediator=function(t){t&&(t.dispose(),t.node=null)},t.prototype._destroy=function(t){for(var e=this.MEDIATORS_CACHE.length,n=0;n<e;n++){var r=this.MEDIATORS_CACHE[n];r?r.node&&r.node!==t||(r.dispose&&r.dispose(),r.node=null,this.MEDIATORS_CACHE[n]=null):this.MEDIATORS_CACHE[n]=null}return this.MEDIATORS_CACHE.filter(function(t){return t})},t.prototype.destroy=function(t){return this.MEDIATORS_CACHE=this._destroy(t),this.MEDIATORS_CACHE},t.prototype.dispose=function(){this.MEDIATORS_CACHE.forEach(t.disposeMediator),this.MEDIATORS_CACHE=null,this.dispatcher=null},t}(b),x=function(){function t(t){var e=t.definitions,n=t.loader,r=void 0===n?new s:n,i=t.root,o=void 0===i?document.body:i;this.definitions=e,this.loader=r,this.root=o,this.handler=t.handler||new A({definitions:e}),this.domWatcher=t.domWatcher||new v(o,this.handler.getAllElements.bind(this.handler)),this.domWatcher.onAdded.connect(this.handleAdded.bind(this)),this.domWatcher.onRemoved.connect(this.handleRemoved.bind(this)),this.init()}return t.prototype.init=function(){var t=[this.root].map(this.handler.getAllElements.bind(this.handler));this.promise=this.getMediators(t)},t.prototype.handleAdded=function(t){var n=this,e=(t=y(t)).filter(this.handler.hasMediator.bind(this.handler)).map(function(e){return n.loader.load(n.handler.getDefinition(e)).then(function(t){return n.handler.create(e,t)}).then(n.handler.updateCache.bind(n.handler))});return Promise.all(e)},t.prototype.handleRemoved=function(t){t.forEach(this.handler.destroy.bind(this.handler))},t.prototype.getMediators=function(t){var e=(t=y(t)).filter(this.handler.hasMediator.bind(this.handler)).map(this.handler.findMediator.bind(this.handler,this.loader.load.bind(this.loader)));return Promise.all(e)},t.prototype.dispose=function(){this.domWatcher.dispose(),this.handler.dispose(),this.domWatcher=null,this.handler=null,this.definitions=null,this.loader=null,this.root=null,this.promise=null},t}(),C=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1 ","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"].map(function(t){return":not("+t+")"}).reduce(function(t,e){return t+e},"*"),M=function(n){function t(t){var e=n.call(this,t)||this;return e.REGISTERED_ELEMENTS={},e}return i(t,n),t.prototype.updateCache=function(t){return this.REGISTERED_ELEMENTS[t]=!0,this.REGISTERED_ELEMENTS},t.prototype.inCache=function(t){return!!this.REGISTERED_ELEMENTS[t]},t.prototype.getDefinition=function(t){return this.definitions[t.tagName.toLowerCase()]},t.prototype.create=function(t,e){var n="",r=this.dispatcher;if(!this.inCache(t.tagName.toLowerCase())){if(!(n=t.tagName.toLowerCase()).match(/-/gim))throw Error("The name of a custom element must contain a dash (-). So <x-tags>, <my-element>, and <my-awesome-app> are all valid names, while <tabs> and <foo_bar> are not.");window.customElements.define(n,function(t){function e(){return t.call(this,r)||this}return i(e,t),e}(e)),this.updateCache(n)}return n},t.prototype.hasMediator=function(t){var e=t.tagName.toLowerCase();return!!this.getDefinition(t)&&!this.inCache(e)},t.prototype.getAllElements=function(t){return[t].concat([].slice.call(t.querySelectorAll(C),0))},t.prototype.dispose=function(){},t.prototype.destroy=function(){},t}(b);t.bootstrap=function(t){return new x(t)},t.Loader=e,t.AMDLoader=s,t.CustomLoader=r,t.EventTarget=u,t.Signal=l,t.DomWatcher=v,t.MediatorHandler=A,t.Bootstrap=x,t.CustomElementHandler=M});