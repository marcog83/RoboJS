var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.robojs={})}(this,function(t){"use strict";function e(){this._listeners={}}function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.data=e,this.type=t,this.bubbles=n,this.cancelable=r,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1,this.target,this.currentTarget,this.eventPhase=0}function r(){function t(t,e,r){n.filter(function(n){return n.listener===t&&n.scope===e&&function(t){return t.once&&!r||r&&!t.once}}).forEach(function(t){throw new Error("You cannot addOnce() then try to add() the same listener without removing the relationship first.")}),n=n.concat([{listener:t,scope:e,once:r}])}function e(t,e){n=n.filter(function(n){var r=n.listener,i=n.scope;return r!==t&&i!==e})}var n=[];return Object.freeze({connect:function(e,n){return t(e,n,!1)},connectOnce:function(e,n){return t(e,n,!0)},disconnect:e,disconnectAll:function(){n.forEach(function(t){return e(t.listener,t.scope)})},emit:function(t){n.forEach(function(n){var r=n.listener,i=n.scope;n.once&&e(r,i),r.call(i,t)})}})}function i(t,e,n){return function(){for(var r=[],o=0,u=t,a=0;a<e.length||o<arguments.length;){var s;a<e.length?s=e[a]:(s=arguments[o],o+=1),r[a]=s,u-=1,a+=1}return u<=0?n.apply(this,r):p(u,i(t,r,n))}}function o(t,e){return function(){return e.call(this,t.apply(this,arguments))}}function u(t){return"[object String]"===Object.prototype.toString.call(t)}function a(t){for(var e,n,r,i=[],o=0,u=t.length;o<u;){if(x(t[o]))for(r=0,n=(e=a(t[o])).length;r<n;)i[i.length]=e[r],r+=1;else i[i.length]=t[o];o+=1}return i}function s(t,e,n){return b(function(t){return t.length>0?n(t):[]},E(function(t){return t.length>0}),m(e),E(function(t){return t.querySelectorAll}),a,g(t))}var c=function(t,e,n){require([t],e,n)},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;return Object.freeze({load:function(e){return new Promise(function(n,r){return t(e,n,r)})}})};e.prototype={addEventListener:function(t,e,n){var r,i=(r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{})[t];return i&&this.removeEventListener(t,e,n),(i=r[t])?i.push(e):r[t]=[e],e},removeEventListener:function(t,e,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[t];if(i)for(var o=0,u=i.length;o<u;o++)if(i[o]==e){1==u?delete r[t]:i.splice(o,1);break}}},removeAllEventListeners:function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},dispatchEvent:function(t){if("string"==typeof t){var e=this._listeners;if(!e||!e[t])return!1;t=new Event(t)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(t){}if(t.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var i,o=r.length;for(i=o-1;i>=0&&!t.propagationStopped;i--)r[i]._dispatchEvent(t,1+(0==i));for(i=1;i<o&&!t.propagationStopped;i++)r[i]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return t.defaultPrevented},hasEventListener:function(t){var e=this._listeners,n=this._captureListeners;return!!(e&&e[t]||n&&n[t])},_dispatchEvent:function(t,e){var n,r=1==e?this._captureListeners:this._listeners;if(t&&r){var i=r[t.type];if(!i||!(n=i.length))return;try{t.currentTarget=this}catch(t){}try{t.eventPhase=e}catch(t){}t.removed=!1,i=i.slice();for(var o=0;o<n&&!t.immediatePropagationStopped;o++){var u=i[o];u.handleEvent?u.handleEvent(t):u(t),t.removed&&(this.removeEventListener(t.type,u,1==e),t.removed=!1)}}}};var f=new e,d=function(){return new e};n.prototype={preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.propagationStopped=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},remove:function(){this.removed=!0},clone:function(){return new n(this.type,this.data,this.bubbles,this.cancelable)}};var p=function(t,e){switch(t){case 0:return function(){return e.apply(this,arguments)};case 1:return function(t){return e.apply(this,arguments)};case 2:return function(t,n){return e.apply(this,arguments)};case 3:return function(t,n,r){return e.apply(this,arguments)};case 4:return function(t,n,r,i){return e.apply(this,arguments)};case 5:return function(t,n,r,i,o){return e.apply(this,arguments)};case 6:return function(t,n,r,i,o,u){return e.apply(this,arguments)};case 7:return function(t,n,r,i,o,u,a){return e.apply(this,arguments)};case 8:return function(t,n,r,i,o,u,a,s){return e.apply(this,arguments)};case 9:return function(t,n,r,i,o,u,a,s,c){return e.apply(this,arguments)};case 10:return function(t,n,r,i,o,u,a,s,c,l){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}},h=function(t){return function e(n){return 0===arguments.length?e:t.apply(this,arguments)}},v=function(t){var e=t.length;return 1===e?h(t):p(e,i(e,[],t))},m=v(function(t,e){var n=0,r=e.length,i=[];for(n;n<r;n++)i[n]=t(e[n]);return i}),g=v(function(t,e){return m(function(e){return e[t]},e)}),y=v(function(t,e,n){for(var r=0,i=n.length;r<i;)e=t(e,n[r]),r+=1;return e}),b=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];e.reverse();var r=e[0],i=e.slice(1);return p(r.length,y(o,r,i))},x=function(t){return!!Array.isArray(t)||!!t&&("object"===(void 0===t?"undefined":_typeof(t))&&(!u(t)&&(1===t.nodeType?!!t.length:0===t.length||t.length>0&&(t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1)))))},E=v(function(t,e){for(var n=0,r=e.length,i=[];n<r;)t(e[n])&&(i[i.length]=e[n]),n+=1;return i}),_=function(t,e){var n=r(),i=r(),o=s("addedNodes",e,n.emit),u=s("removedNodes",e,i.emit),a=new MutationObserver(function(t){u(t),o(t)});return a.observe(t,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),Object.freeze({onAdded:n,onRemoved:i,dispose:function(){a.disconnect(),n.disconnectAll(),i.disconnectAll(),a=null,n=null,i=null,o=null,u=null}})},L=/[xy]/g,S=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(L,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},w=function(t){return t},A=v(function(t,e,n){var r=S();return t.setAttribute("mediatorid",r),{mediatorId:r,node:t,dispose:n(t,e)||w}}),P=v(function(t,e){for(var n=0,r=e.length;n<r;){if(t(e[n]))return e[n];n+=1}}),j=function(t,e){return!!P(function(t){return t.node===e},t)},O=function(t){var e=[].slice.call(t.querySelectorAll("[data-mediator]"),0);return t.getAttribute("data-mediator")&&e.unshift(t),e},M=function(t,e,n){return v(function(r,i,o){return i(t(o)).then(e(o,r)).then(n)})},k=v(function(t,e){return t[e.getAttribute("data-mediator")]}),q=function(t){var e=t.definitions,n=void 0===e?{}:e,r=t.dispatcher,i=void 0===r?d():r,o=[],u=k(n),a=M(u,A,function(t){return o.push(t),o});return Object.freeze({dispose:function(){o.forEach(function(t){t&&(t.dispose(),t.node=null)}),o=null,i.removeAllEventListeners(),i=null,a=null,n=null,u=null},destroy:function(t){for(var e=0;e<o.length;e++){var n=o[e];n&&n.node===t&&(n.dispose(),n.node=null,o[e]=null,o.splice(e,1))}return o},findMediator:a(i),hasMediator:function(t){return!!u(t)&&!j(o,t)},getAllElements:O})},D=function(t,e){return b(function(t){return Promise.all(t)},m(t),E(e),a)},N=v(function(t,e){for(var n=e.length,r=0;r<n;)t(e[r]),r+=1;return e}),z=function(t){return b(N(t),a)},C=function(t,e){return b(t,m(e),function(t){return[t]})},T=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1 ","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"].map(function(t){return":not("+t+")"}).reduce(function(t,e){return t+e},"*"),H=function(t){return[t].concat([].slice.call(t.querySelectorAll(T),0))},R=function(t,e){return function(n,r){return function(i){var o="";if(!t(n.tagName.toLowerCase())){o=n.tagName.toLowerCase();var u=i(r),a=Object.assign(Object.create(HTMLElement.prototype),u);document.registerElement(o,{prototype:a}),e(o)}return o}}},I=v(function(t,e){return t[e.tagName.toLowerCase()]}),W=function(t){return t};t.Loader=l,t.EventDispatcher=f,t.makeDispatcher=d,t.RJSEvent=n,t.Signal=r,t.DomWatcher=_,t.MediatorHandler=q,t.bootstrap=function(t){var e=t.definitions,n=t.loader,r=void 0===n?l():n,i=t.root,o=void 0===i?document.body:i,u=t.handler||q({definitions:e}),a=t.domWatcher||_(o,u.getAllElements),s=D(u.findMediator(r.load),u.hasMediator);a.onAdded.connect(s),a.onRemoved.connect(z(u.destroy));var c=C(s,u.getAllElements)(o);return{promise:c,dispose:function(){a.dispose(),u.dispose(),a=null,u=null,s=null,e=null,r=null,o=null,c=null}}},t.CustomElementHandler=function(t){var e=t.definitions,n=void 0===e?{}:e,r=t.dispatcher,i=void 0===r?d():r,o={},u=v(function(t,e){return!!t[e]}),a=I(n),s=M(a,R(u(o),function(t){return o[t]=!0,o}),W);return Object.freeze({dispose:W,destroy:W,findMediator:s(i),hasMediator:function(t){var e=t.tagName.toLowerCase();return!!a(t)&&!u(o,e)},getAllElements:H})},Object.defineProperty(t,"__esModule",{value:!0})});