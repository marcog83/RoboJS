"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.robojs={})}(void 0,function(e){function t(){this._listeners={}}function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.data=t,this.type=e,this.bubbles=n,this.cancelable=r,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1,this.target,this.currentTarget,this.eventPhase=0}function r(e,t,n){return function(){for(var i=[],s=0,o=e,a=0;a<t.length||s<arguments.length;){var u;a<t.length?u=t[a]:(u=arguments[s],s+=1),i[a]=u,o-=1,a+=1}return o<=0?n.apply(this,i):c(o,r(e,i,n))}}function i(e){for(var t,n,r,s=[],o=0,a=e.length;o<a;){if(g(e[o]))for(r=0,n=(t=i(e[o])).length;r<n;)s[s.length]=t[r],r+=1;else s[s.length]=e[o];o+=1}return s}function s(e,t,n){return v(function(e){return e.length>0?n(e):[]},m(function(e){return e.length>0}),h(t),m(function(e){return e.querySelectorAll}),i,d(e))}var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t,n){require([e],t,n)};return Object.freeze({load:function(t){return new Promise(function(n,r){return e(t,n,r)})}})};t.prototype={addEventListener:function(e,t,n){var r,i=(r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{})[e];return i&&this.removeEventListener(e,t,n),(i=r[e])?i.push(t):r[e]=[t],t},removeEventListener:function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var s=0,o=i.length;s<o;s++)if(i[s]==t){1==o?delete r[e]:i.splice(s,1);break}}},removeAllEventListeners:function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},dispatchEvent:function(e){if("string"==typeof e){var t=this._listeners;if(!t||!t[e])return!1;e=new Event(e)}else e.target&&e.clone&&(e=e.clone());try{e.target=this}catch(e){}if(e.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var i,s=r.length;for(i=s-1;i>=0&&!e.propagationStopped;i--)r[i]._dispatchEvent(e,1+(0==i));for(i=1;i<s&&!e.propagationStopped;i++)r[i]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented},hasEventListener:function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},_dispatchEvent:function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;try{e.currentTarget=this}catch(e){}try{e.eventPhase=t}catch(e){}e.removed=!1,i=i.slice();for(var s=0;s<n&&!e.immediatePropagationStopped;s++){var o=i[s];o.handleEvent?o.handleEvent(e):o(e),e.removed&&(this.removeEventListener(e.type,o,1==t),e.removed=!1)}}}};var a=new t,u=function(){return new t};n.prototype={preventDefault:function(){this.defaultPrevented=!0},stopPropagation:function(){this.propagationStopped=!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},remove:function(){this.removed=!0},clone:function(){return new n(this.type,this.data,this.bubbles,this.cancelable)}};var l=function(){function e(){_classCallCheck(this,e),this.listenerBoxes=[],this._valueClasses=null,this.listenersNeedCloning=!1,this.setValueClasses(arguments)}return _createClass(e,[{key:"getNumListeners",value:function(){return this.listenerBoxes.length}},{key:"getValueClasses",value:function(){return this._valueClasses}},{key:"connect",value:function(e,t){this.registerListener(e,t,!1)}},{key:"connectOnce",value:function(e,t){this.registerListener(e,t,!0)}},{key:"disconnect",value:function(e,t){this.listenersNeedCloning&&(this.listenerBoxes=this.listenerBoxes.slice(),this.listenersNeedCloning=!1);for(var n=this.listenerBoxes.length;n--;)if(this.listenerBoxes[n].listener==e&&this.listenerBoxes[n].scope==t)return void this.listenerBoxes.splice(n,1)}},{key:"disconnectAll",value:function(){for(var e=this.listenerBoxes.length;e--;)this.disconnect(this.listenerBoxes[e].listener,this.listenerBoxes[e].scope)}},{key:"emit",value:function(){for(var e,t=0;t<this._valueClasses.length;t++)if(!this.primitiveMatchesValueClass(arguments[t],this._valueClasses[t])&&!(null==(e=arguments[t])||e instanceof this._valueClasses[t]))throw new Error("Value object <"+e+"> is not an instance of <"+this._valueClasses[t]+">.");var n,r=this.listenerBoxes,i=r.length;this.listenersNeedCloning=!0;for(var s=0;s<i;s++)(n=r[s]).once&&this.disconnect(n.listener,n.scope),n.listener.apply(n.scope,arguments);this.listenersNeedCloning=!1}},{key:"primitiveMatchesValueClass",value:function(e,t){return"string"==typeof e&&t==String||"number"==typeof e&&t==Number||"boolean"==typeof e&&t==Boolean}},{key:"setValueClasses",value:function(e){this._valueClasses=e||[];for(var t=this._valueClasses.length;t--;)if(!(this._valueClasses[t]instanceof Function))throw new Error("Invalid valueClasses argument: item at index "+t+" should be a Class but was:<"+this._valueClasses[t]+">.")}},{key:"registerListener",value:function(e,t,n){for(var r=0;r<this.listenerBoxes.length;r++)if(this.listenerBoxes[r].listener==e&&this.listenerBoxes[r].scope==t){if(this.listenerBoxes[r].once&&!n)throw new Error("You cannot addOnce() then try to add() the same listener without removing the relationship first.");if(n&&!this.listenerBoxes[r].once)throw new Error("You cannot add() then addOnce() the same listener without removing the relationship first.");return}this.listenersNeedCloning&&(this.listenerBoxes=this.listenerBoxes.slice()),this.listenerBoxes.push({listener:e,scope:t,once:n})}}]),e}(),c=function(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,i){return t.apply(this,arguments)};case 5:return function(e,n,r,i,s){return t.apply(this,arguments)};case 6:return function(e,n,r,i,s,o){return t.apply(this,arguments)};case 7:return function(e,n,r,i,s,o,a){return t.apply(this,arguments)};case 8:return function(e,n,r,i,s,o,a,u){return t.apply(this,arguments)};case 9:return function(e,n,r,i,s,o,a,u,l){return t.apply(this,arguments)};case 10:return function(e,n,r,i,s,o,a,u,l,c){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}},f=function(e){var t=e.length;return 1===t?function(e){return function t(n){return 0===arguments.length?t:e.apply(this,arguments)}}(e):c(t,r(t,[],e))},h=f(function(e,t){var n=0,r=t.length,i=[];for(n;n<r;n++)i[n]=e(t[n]);return i}),d=f(function(e,t){return h(function(t){return t[e]},t)}),p=f(function(e,t,n){for(var r=0,i=n.length;r<i;)t=e(t,n[r]),r+=1;return t}),v=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.reverse();var r=t[0],i=t.slice(1);return c(r.length,p(function(e,t){return function(){return t.call(this,e.apply(this,arguments))}},r,i))},g=function(e){return!!Array.isArray(e)||!!e&&("object"===(void 0===e?"undefined":_typeof(e))&&(!function(e){return"[object String]"===Object.prototype.toString.call(e)}(e)&&(1===e.nodeType?!!e.length:0===e.length||e.length>0&&(e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1)))))},m=f(function(e,t){for(var n=0,r=t.length,i=[];n<r;)e(t[n])&&(i[i.length]=t[n]),n+=1;return i}),y=function(e,t){var n=new l,r=new l,i=s("addedNodes",t,n.emit),o=s("removedNodes",t,r.emit),a=new MutationObserver(function(e){o(e),i(e)});return a.observe(e,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),Object.freeze({onAdded:n,onRemoved:r,dispose:function(){a.disconnect(),n.disconnectAll(),r.disconnectAll(),a=null,n=null,r=null,i=null,o=null}})},b=/[xy]/g,x=f(function(e,t,n){var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(b,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});e.setAttribute("mediatorid",r);return{mediatorId:r,node:e,dispose:n(e,t)||function(e){return e}}}),_=f(function(e,t){for(var n=0,r=t.length;n<r;){if(e(t[n]))return t[n];n+=1}}),C=function(e,t){return!!_(function(e){return e.node===t},e)},w=function(e,t,n){return f(function(r,i,s){return i(e(s)).then(t(s,r)).then(n)})},E=f(function(e,t){return e[t.getAttribute("data-mediator")]}),L=function(e){var t=e.definitions,n=void 0===t?{}:t,r=e.dispatcher,i=void 0===r?u():r,s=[],o=E(n),a=w(o,x,function(e){return s.push(e),s});return Object.freeze({dispose:function(){s.forEach(function(e){e&&(e.dispose(),e.node=null)}),s=null,i.removeAllEventListeners(),i=null,a=null,n=null,o=null},destroy:function(e){for(var t=0;t<s.length;t++){var n=s[t];n&&n.node===e&&(n.dispose(),n.node=null,s[t]=null,s.splice(t,1))}return s},findMediator:a(i),hasMediator:function(e){return!!o(e)&&!C(s,e)},getAllElements:function(e){var t=[].slice.call(e.querySelectorAll("[data-mediator]"),0);return e.getAttribute("data-mediator")&&t.unshift(e),t}})},S=f(function(e,t){for(var n=t.length,r=0;r<n;)e(t[r]),r+=1;return t}),k=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1 ","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"].map(function(e){return":not("+e+")"}).reduce(function(e,t){return e+t},"*"),B=f(function(e,t){return e[t.tagName.toLowerCase()]}),A=function(e){return e};e.Loader=o,e.EventDispatcher=a,e.makeDispatcher=u,e.RJSEvent=n,e.Signal=l,e.DomWatcher=y,e.MediatorHandler=L,e.bootstrap=function(e){var t=e.definitions,n=e.loader,r=void 0===n?o():n,s=e.root,a=void 0===s?document.body:s,u=e.handler||L({definitions:t}),l=e.domWatcher||y(a,u.getAllElements),c=function(e,t){return v(function(e){return Promise.all(e)},h(e),m(t),i)}(u.findMediator(r.load),u.hasMediator);l.onAdded.connect(c),l.onRemoved.connect(function(e){return v(S(e),i)}(u.destroy));var f=function(e,t){return v(e,h(t),function(e){return[e]})}(c,u.getAllElements)(a);return{promise:f,dispose:function(){l.dispose(),u.dispose(),l=null,u=null,c=null,t=null,r=null,a=null,f=null}}},e.CustomElementHandler=function(e){var t=e.definitions,n=void 0===t?{}:t,r=e.dispatcher,i=void 0===r?u():r,s={},o=f(function(e,t){return!!e[t]}),a=B(n),l=w(a,function(e,t){return function(n,r){return function(i){var s="";if(!e(n.tagName.toLowerCase())){s=n.tagName.toLowerCase();var o=i(r),a=Object.assign(Object.create(HTMLElement.prototype),o);document.registerElement(s,{prototype:a}),t(s)}return s}}}(o(s),function(e){return s[e]=!0,s}),A);return Object.freeze({dispose:A,destroy:A,findMediator:l(i),hasMediator:function(e){var t=e.tagName.toLowerCase();return!!a(e)&&!o(s,t)},getAllElements:function(e){return[e].concat([].slice.call(e.querySelectorAll(k),0))}})},Object.defineProperty(e,"__esModule",{value:!0})});