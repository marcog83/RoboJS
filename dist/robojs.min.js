/*! robojs 0.20.1 (RoboJS Build) | MIT */
!function(a,b){"function"==typeof define&&define.amd?define("robojs",["Promise"],b):a.RoboJS=b(a.Promise)}(this,function(a){"use strict";function b(){this.listenerBoxes=[],this._valueClasses=null,this.listenersNeedCloning=!1,this.setValueClasses(arguments)}function c(){function a(a){var b=a.reduce(function(a,b){return a.addedNodes=a.addedNodes.concat(Array.prototype.slice.call(b.addedNodes)),a.removedNodes=a.removedNodes.concat(Array.prototype.slice.call(b.removedNodes)),a},{addedNodes:[],removedNodes:[]});b.addedNodes.length&&c.emit(b.addedNodes),b.removedNodes.length&&d.emit(b.removedNodes)}var c=new b,d=new b,e=new MutationObserver(a);return e.observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),{onAdded:c,onRemoved:d}}function d(a,b){this.eventMap=b,this.eventDispatcher=a}function e(c,d,e,f){function g(a,b){return a.getAttribute("data-mediator")==b.id}function h(a,b){return d.get(b.mediator).then(e.create.bind(null,a,b))}function i(a,b){var c=f.filter(g.bind(null,b)).map(h.bind(null,b));return a.concat(c)}function j(b){return a.all(b.reduce(n,[]).reduce(i,[]))}function k(a){j(a).then(l)}function l(a){a.length&&p.emit(a)}function m(a){a.reduce(n,[]).forEach(o)}function n(a,b){if(!b||!b.getElementsByTagName)return a;var c=[].slice.call(b.getElementsByTagName("*"),0);return c.unshift(b),a.concat(c)}function o(a){var b=e.destroy(a);b&&q.emit(b)}var p=new b,q=new b;return c.onAdded.connect(k),c.onRemoved.connect(m),{onAdded:p,onRemoved:q,bootstrap:function(){return j([document.body])}}}function f(){this._currentListeners={}}function g(a,b,c,d,e){this.dispatcher=a,this.eventString=b,this.listener=c,this.callback=d,this.scope=e}function h(){var a=[];return{mapListener:function(b,c,d,e){for(var f,h=a.length;h--;)if(f=a[h],f.equalTo(b,c,d))return;var i=d;f=new g(b,c,d,i,e),a.push(f),b.addEventListener(c,i,e)},unmapListener:function(b,c,d){for(var e=a.length;e--;){var f=a[e];if(f.equalTo(b,c,d))return b.removeEventListener(c,f.callback,f.scope),void a.splice(e,1)}},unmapListeners:function(){for(var b,c;b=a.pop();)c=b.dispatcher,c.removeEventListener(b.eventString,b.callback,b.scope)}}}function i(a){a.autoplay=void 0==a.autoplay?!0:a.autoplay;var b=a.domWatcher||c(),d=a.scriptLoader||j,f=a.mediatorHandler||k,g=e(b,d,f,a.definitions);return a.autoplay?g.bootstrap():g}var RoboJS={MEDIATORS_CACHE:{},utils:{uid:["0","0","0"],nextUid:function(){for(var a,b=this.uid.length;b;){if(b--,a=this.uid[b].charCodeAt(0),57==a)return this.uid[b]="A",this.uid.join("");if(90!=a)return this.uid[b]=String.fromCharCode(a+1),this.uid.join("");this.uid[b]="0"}return this.uid.unshift("0"),this.uid.join("")},flip:function(a){var b=a;return function(){var a=Array.prototype.slice.call(arguments);return b.apply(this,a.reverse())}}}};b.prototype={getNumListeners:function(){return this.listenerBoxes.length},getValueClasses:function(){return this._valueClasses},connect:function(a,b){this.registerListener(a,b,!1)},connectOnce:function(a,b){this.registerListener(a,b,!0)},disconnect:function(a,b){this.listenersNeedCloning&&(this.listenerBoxes=this.listenerBoxes.slice(),this.listenersNeedCloning=!1);for(var c=this.listenerBoxes.length;c--;)if(this.listenerBoxes[c].listener==a&&this.listenerBoxes[c].scope==b)return void this.listenerBoxes.splice(c,1)},disconnectAll:function(){for(var a=this.listenerBoxes.length;a--;)this.disconnect(this.listenerBoxes[a].listener,this.listenerBoxes[a].scope)},emit:function(){for(var a,b=0;b<this._valueClasses.length;b++)if(!this.primitiveMatchesValueClass(arguments[b],this._valueClasses[b])&&!(null==(a=arguments[b])||a instanceof this._valueClasses[b]))throw new Error("Value object <"+a+"> is not an instance of <"+this._valueClasses[b]+">.");var c,d=this.listenerBoxes,e=d.length;this.listenersNeedCloning=!0;for(var f=0;e>f;f++)c=d[f],c.once&&this.disconnect(c.listener,c.scope),c.listener.apply(c.scope,arguments);this.listenersNeedCloning=!1},primitiveMatchesValueClass:function(a,b){return"string"==typeof a&&b==String||"number"==typeof a&&b==Number||"boolean"==typeof a&&b==Boolean?!0:!1},setValueClasses:function(a){this._valueClasses=a||[];for(var b=this._valueClasses.length;b--;)if(!(this._valueClasses[b]instanceof Function))throw new Error("Invalid valueClasses argument: item at index "+b+" should be a Class but was:<"+this._valueClasses[b]+">.")},registerListener:function(a,b,c){for(var d=0;d<this.listenerBoxes.length;d++)if(this.listenerBoxes[d].listener==a&&this.listenerBoxes[d].scope==b){if(this.listenerBoxes[d].once&&!c)throw new Error("You cannot addOnce() then try to add() the same listener without removing the relationship first.");if(c&&!this.listenerBoxes[d].once)throw new Error("You cannot add() then addOnce() the same listener without removing the relationship first.");return}this.listenersNeedCloning&&(this.listenerBoxes=this.listenerBoxes.slice()),this.listenerBoxes.push({listener:a,scope:b,once:c})}},d.inherit=function(a,b){d.apply(a,Array.prototype.slice.call(b,-2))},d.prototype={postDestroy:function(){this.eventMap.unmapListeners()},addContextListener:function(a,b,c){this.eventMap.mapListener(this.eventDispatcher,a,b,c)},removeContextListener:function(a,b){this.eventMap.unmapListener(this.eventDispatcher,a,b)},dispatch:function(a,b){this.eventDispatcher.hasEventListener(a)&&this.eventDispatcher.dispatchEvent(a,b)},initialize:function(a){this.element=a},destroy:function(){}};var j={get:function(b){return new a(function(a,c){require([b],a,c)})}};f.prototype={addEventListener:function(a,b,c){var d={type:a,callback:b,scope:c};return this._currentListeners[a]||(this._currentListeners[a]=[]),this._currentListeners[a].push(d),d},removeEventListener:function(a,b,c){var d=this._currentListeners[a]||[];this._currentListeners[a]=d.filter(function(a){var d=a.callback==b,e=a.scope==c;return!(d&&e)})},removeAllEventListeners:function(a){this._currentListeners[a]=null},hasEventListener:function(a){return this._currentListeners[a]&&this._currentListeners[a].length},dispatchEvent:function(a,b){for(var c,d,e,f=this._currentListeners[a]||[],g=f.length,h=0;g>h;h++)c=f[h],d=c.callback,e=c.scope,d.call(e,b)}},f.__instance=null,f.getInstance=function(){return f.__instance||(f.__instance=new f),f.__instance},g.prototype={equalTo:function(a,b,c){return this.eventString==b&&this.dispatcher==a&&this.listener==c}};var k={create:function(a,b,c){var d=RoboJS.utils.nextUid();a.setAttribute("mediatorId",d);var e=new c(f.getInstance(),h());return e.id=d,RoboJS.MEDIATORS_CACHE[d]=e,e.initialize(a),e},destroy:function(a){var b=a.getAttribute("mediatorId"),c=RoboJS.MEDIATORS_CACHE[b];c&&(c.destroy&&c.destroy(),c.postDestroy&&c.postDestroy(),c.element&&(c.element=null),RoboJS.MEDIATORS_CACHE[b]=null,c=null)}};return RoboJS.display={DisplayList:c,Mediator:d,bootstrap:i,MediatorHandler:k,MediatorsBuilder:e},RoboJS.events={EventDispatcher:f,EventMap:h,EventMapConfig:g,Signal:b},RoboJS.net={ScriptLoader:j},RoboJS});
//# sourceMappingURL=robojs.min.js.map